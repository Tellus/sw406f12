\section{Language semantics}
%I don't like this anymore :/ ~Hornbjerg
\begin{comment}
The language is a language used for  of a role-playing characters. I addiction to the language is an battle engine, which simulates a battle between the  character. \\
The engine works, so that lets one character make an action, then the turn end, and the other character then gets to make its action. \\
The action a character makes, is calculated by an AI-behaviour. The AI-behaviour is base at a behaviour declared for the character. \\
Before a character gets to make its turn, win condition is checked, so that the character does not get to make an action if its health is below zero.  

\subsection{Environment-store model}
The semantics of the language is base at the environment-store model, which is a a model describing how variables are bound during a program execution. Each variable is bound to a storage cell, and the content of the storage cell is the value of the variable.

\subsection{\langname{} semantics}
\end{comment}

%{\Large[The real stuff]}
The semantics of \langname{} are based on the environment-store model, described in section \ref{sec:semantic}.
The semantics are split into two parts; declarations in \langname{}, and the inner workings of the engine used to simulate a battle between two characters.
\subsection*{\langname{}}
In \langname{} it is possible for the user to use references, they are called \ac{rgrs}. In the semantics of \langname{}, \ac{rgr} is a set of keywords used to refer to characters.\\ \textbf{RGR} is defined as follows;  
%
$$\mathbf{RGR} = \{\texttt{owner, enemy}\}$$
%
\ac{rgrs} are used in the declaration of abilities and behaviour. An ability is declared by a name and contains; the targets to be effected by the ability, an effect corresponding carried out by the ability and two values. The first value representing the mana cost of the ability and the second representing the damage done.\\
To keep track of the bindings of an ability, an \textit{ability environment} is used. The set of ability environments is called \textbf{Ability}. 
Given an ability name \textit{AName}, an ability environment must hold information about, targets, effect, cost, and damage. Therefore the definition of the set of ability environments \textbf{Ability} is:
%
$$\mathbf{Ability: \; AName \rightharpoonup \mathcal{P}(RGR) \times Effect \times Integer \times Integer}$$
%
Transition rules for declaration of ability are of the form
%
{\small $$\langle Char, Ability, Behaviour, Event \rangle \Rightarrow_{DecA} \langle Char, Ability', Bahavior, Event \rangle$$}
%
The transition system for ability declaration is 

\begin{tabular}{l l}
$\Gamma_{DecA} = $ & $\mathbf{Character \times Ability \times Bahaviour \times Event}$ \\
$\Rightarrow_{DecA}$ & \\
$T_{DecA} = $ & $\mathbf{Character \times Ability \times Behaviour \times Event}$ \\
\end{tabular}
\\\\
$\Rightarrow_{DecA}$ is defined by the rules in table \ref{tbl:decA}.\\\\
%
\begin{table}[!h]
\begin{tabular}{l l}
\\ \hline \\
\small{\textsc{[Ability-Dec]}}& \\
 & \footnotesize{$\langle Char, Ability, Behaviour, Event; \; Ability AName RGR, Effect, Int, Int \rangle \; \Rightarrow$} \\
 & \footnotesize{$\langle Char, Ability[AName \mapsto (RGR, Effect, Int, Int)], Behaviour, Event; S \rangle$} \\
\\ \hline
\end{tabular}
\caption{Transition rules for $\Rightarrow_{DecA}$}
\label{tbl:decA}
\end{table}
%
As mentioned, \ac{rgrs} are used for behaviour as well. A behaviour is declared by a name and it contains a list of 3-tuples (\textbf{\ac{rgr}}, \textbf{VName}, \textbf{Integer}), where \textbf{\ac{rgr}} is a reference to the involved character, \textbf{VName} is the name of the involved attribute and \textbf{Integer} is a value representing the priority of the attribute. To keep track of the bindings of a behaviour, a \textit{behaviour environment} is used. The set of behaviour environments is called \textbf{Behaviour}.
A behaviour environment must, given a behaviour name \textit{BName}, hold information of the list of 3-tuples. Therefore the definition of the set of behaviour environments is:
%
$$\mathbf{Behaviour: \; BName \rightharpoonup \mathcal{P}(RGR \times VName \times Integer)}$$
%
Transition rules for declaration of behaviour are of the form
%
{\small $$\langle Char, Ability, Behaviour, Event \rangle \Rightarrow_{DecB} \langle Char, Ability, Bahavior', Event \rangle$$}
%
The transition system for declaration of behaviour is

\begin{tabular}{l l}
$\Gamma_{DecB} = $ & $\mathbf{Character \times Ability \times Bahaviour \times Event}$ \\
$\Rightarrow_{DecB}$ & \\
$T_{DecB} = $ & $\mathbf{Character \times Ability \times Behaviour \times Event}$ \\
\end{tabular}
\\\\
$\Rightarrow_{DecB}$ is defined by the rules in table \ref{tbl:decB}.\\\\
%
\begin{table}[!h]
\begin{tabular}{l l l}
\\ \hline \\
\small{\textsc{[Behaviour-Dec]}} & \\
 & \footnotesize{$\langle Char, Ability, Behaviour, Event; Behaviour BName,$} & \footnotesize{$RGR_1, VName_1, Integer_1$} \\
 & & \footnotesize{$RGR_2, VName_2, Integer_2$}\\
 & & \footnotesize{$RGR_3, VName_3, Integer_3$} \\
 & & \footnotesize{$\vdots$} \\
 & & \footnotesize{$RGR_n, VName_n, Integer_n  \rangle ; S \; \Rightarrow$} \\
\end{tabular}
\begin{tabular}{l p{0.92\textwidth}}
 & \footnotesize{$\langle Char, Ability, Behaviour', Event \rangle; S$} \\ %& \color{white} \footnotesize{$RGR_1, VName_1, Integer_1 \Rightarrow$} \\
\footnotesize{Where $Behaviour' = $} & \footnotesize{$Behaviour[BName \mapsto {\bigcup^{n}_{i = 0}} (RGR_i, VName_i, Integer_i)]$} \\
\\  \hline 
\end{tabular}
\caption{Transition rules for $\Rightarrow_{DecB}$}
\label{tbl:decB}
\end{table}
%
%Event
For declaring forced action for a character, \langname{} makes it possible for a user to declare event, which contains a trigger(decrease of health), a condition(health below 10\%) and an ability to execute when both the trigger and the condition is meet.
A \textit{event environment} is used to keep track of the binding for events. The set of event environments is called \textbf{Event}.
Given an event name, the event environment must hold information about the trigger, condition and ability. Therefore the definition of the set of event environments is:
%
$$\mathbf{Event : \; EName \rightharpoonup Trigger \times Condition \times AName}$$
%
Transition rules for declaration of event are of the form
%
{\small $$\langle Char, Ability, Behaviour, Event \rangle \Rightarrow_{DecE} \langle Char, Ability, Bahavior, Event' \rangle$$}
%
The transition system for declaration of event is

\begin{tabular}{l l}
$\Gamma_{DecE} = $ & $\mathbf{Character \times Ability \times Bahaviour \times Event}$ \\
$\Rightarrow_{DecE}$ & \\
$T_{DecE} = $ & $\mathbf{Character \times Ability \times Behaviour \times Event}$ \\
\end{tabular}
\\\\
$\Rightarrow_{DecE}$ is defined by the rules in table \ref{tbl:decE}.\\\\
%Transition rules for declaration of event can be seen in table \ref{tbl:devE}.
%
\begin{table}[!h]
\begin{tabular}{l l}
 \\ \hline \\
 \small{\textsc{[Event-Dec]}} & \\
 & \footnotesize{$\langle Char ,Ability, Behaviour, Event; \; Event EName, Trigger, Condition, AName \rangle ; \; S \Rightarrow$} \\
 & \footnotesize{$\langle Char, Ability, Behaviour, Event; Event[EName \mapsto (Trigger, Condition, AName)]; S \rangle$} \\
 \\ \hline
\end{tabular}
\caption{Transition rules for $\Rightarrow_{DecE}$}
\label{tbl:decE}
\end{table}
%
%Resource
When a character is declared, they are declared with some resources like health and mana. The resources have a maximum and minimum value. A resource therefore has bindings for the two values. To keep track of these bindings a \textit{resource environment} is used.\\
The set of resource environments is called \textbf{Resource}, and is defined as follows:
%
$$\mathbf{Resource : \; RName \rightharpoonup Integer \times Integer}$$
%
There is no written transition rules and system for \textbf{Resource}, because resource is not declared for it self. Resources are declared in the same step as a character is declared.
It is also required to keep track of the bindings of the character itself. To keep track of the bindings a \textit{character environment} is used. The set of character environments is called \textbf{Character}.
Given a character name \textit{CName}, a character environment must hold information about the behaviour, abilities, attributes, events and resources bound to the character. Therefore the definition of the set of character environments \textbf{Character} is:
%
$$\mathbf{Character} : \; \mathbf{CName} \rightharpoonup \mathbf{Behaviour} \times \mathbf{\mathcal{P}(AName)} \times \mathbf{EnvV} \times \mathbf{EName} \times \mathbf{Resource}$$
%
Transition rules for declaration of character are of the form
%
{\small $$\langle dec_C, A_D, R_D, Ability, Behaviour, Events \rangle
\Rightarrow_{DecC} 
\langle sto, Char' \rangle$$}
\begin{comment}
{\small $$\langle CName, A_D, R_D, Ability, Behaviour, Events \rangle
\Rightarrow_{DecC} 
\langle sto, Attribute, HP, Integer \rangle$$}
\end{comment}
%
The transition system for declaration of character is 

\begin{tabular}{l l}
$\Gamma_{DecC} = $ & $\mathbf{DecC \times EnvV \times Resource \times Ability \times Bahaviour \times Event}$ \\
$\Rightarrow_{DecC}$ & \\
$T_{DecC} = $ & $\mathbf{Character \times Sto}$ \\
\end{tabular}
\\\\
\todo{I'm not sure this system is right, but I guess Danny will comment on it Friday}
$\Rightarrow_{DecC}$ is defined by the rules in table \ref{tbl:decC}\todo{explain ect.'s}.\\\\

\begin{table}[!h]
\begin{tabular}{l l}
\\ \hline \\
\small{\textsc{[Char-Dec]}} \\
 & \large{${\frac{\langle env, Health, Mana, sto, etc \rangle \; \Rightarrow \; env'}
 {\langle \texttt{make }  CName \texttt{ from } Character, \; CName, A_D, R_D, Ability, Behaviour, Events \rangle}}$}\\
 & \footnotesize{$\Rightarrow env \; \vdash \; \langle sto, Attribute, HP, Integer \rangle$} \\
 \footnotesize{Where} $env'=$ &  \footnotesize{$env[Health \mapsto l] [\texttt{next} \mapsto \texttt{new } l, sto \mapsto std]$} \\
 & \footnotesize{$env[Mana \mapsto \texttt{new } l][\texttt{next } \mapsto \texttt{new new } l, sto \mapsto std]$} \\
 & \footnotesize{etc.} \\
 \\ \hline
\end{tabular}
\caption{Transition rules for $\Rightarrow_{DecC}$ (\textsl{Remember to explain the ect.'s})}
\label{tbl:decC}
\end{table}	
The declaration of attributes and effects are not described above. As it can be seen i table \ref{tbl:decC} there is used an environment $env$, which is the environment used to keep track of bindings of attributes.

Effects are not described, because it is currently not possible for a user to declare 'user-effects'. The effect are hard-coded in the engine, and therefore it is not possible for at user to declare, and therefore the declaration of effect are not described in the semantic of \langname{}.
%
%
%\todo{Missing some declarations, which should be described with clean text}
\subsection*{\langname{} battle-engine}
%this is test text
The battle-engine for \langname{} runs in turns, each turn is executed if a certain win-condition is not met. 
The win-condition is (like effects) hard-coded in the engine, and it is therefore not possible for a user to specify the win-condition in the \langname{} language. At this point, the win-condition is met, if the enemy of the current character has zero or less \ac{hp}.

At the start of each turn, the win-condition is therefore checked, if it is met the battle ends, else the turn is executed in the following way;

\begin{description}
\item[1] The character which have to make an action during the current turn is chosen.
\item[2] It is checked whether an event is triggered, if so the forced action is executed and point \textbf{3} and \textbf{4} are skipped. The event is basically a boolean expression consisting of a trigger and a condition. As long as both values do not evaluate to true, the event expression is false and the turn continues to point \textbf{3}.
\item[3] Based on the declared behaviour, the best action to execute is calculated and chosen, by simulation every possible action and the outcome of it.
\item[4] The chosen best action is executed.
\item[5] A new turn start an the win-condition is checked.
\item[5] If the win-condition is not met the turn continue from point \textbf{1}.
\end{description}

The only thing a turn does when it is executed all alone, it swapping the current character with the next character, so the current character becomes the next, and the next character becomes the current.\\

Transition rules for execution of a turn are of the form
{\small $$Char, Behaviour, Ability, Event, Resource \vdash \langle Active, Next, sto \rangle \Rightarrow_{TURN} \langle Next, Active, sto \rangle$$}
The transition system for execution of a turn is

%\todo{Write the last of it}
\begin{tabular}{l l}
$\Gamma_{TURN} = $ & $\mathbf{Character \times Sto}$ \\
$\Rightarrow_{TURN}$ & \\
$T_{TURN} = $ & $\mathbf{Character \times Sto}$ \\
\end{tabular}
\\\\
$\Rightarrow_{TURN}$ is defined by the rules in table \ref{tbl:Turn}.\\\\
\begin{table}[!h]
\begin{tabular}{l l}
\\ \hline \\
\small{\textsc{[Turn]}} & \\
 & \footnotesize{$Char, Behaviour, Ability, Event, Resource \vdash \langle Active, Next, sto \rangle \Rightarrow_{TURN} \langle Next, Active, sto \rangle$} \\
% \\
\footnotesize{Where} & \footnotesize{$Char(Active) = (Behaviour, \mathcal{P}(AName), env, EName, Resource)$} \\
\footnotesize{And} & \footnotesize{$Env(Health) > 0$ (win-condition not meet)} \\
 & \footnotesize{$\forall e \in Events. Event(e) \rightarrow_b f \! \! f$} \\
 & \footnotesize{$Be = Behaviour(Beh)$} \\
\\ \hline
\end{tabular}
\caption{Transition rules for $\Rightarrow_{TURN}$}
\label{tbl:Turn}
\end{table}
%
During a turn an ability is executed. The execution of an ability changes the values of the one(or both) of the involved characters .
All abilities have mana cost, default set to zero. When an ability is executed, the cost of that given ability is subtracted from the mana pool of the executing character. \\

Transition rules for execution of an ability are of the form
%
{\small $$Char_{Active}, Char_{Next}, Ability \vdash \langle AName, sto \rangle \Rightarrow_{A\_exe} \langle sto' \rangle$$}
The transition system for execution of an ability is

\begin{tabular}{l l}
$\Gamma_{A\_exe} = $ & $\mathbf{Character \times Sto}$ \\
$\Rightarrow_{A\_exe}$ & \\
$T_{A\_exe} = $ & $\mathbf{Sto}$ \\
\end{tabular}
\\\\
$\Rightarrow_{A\_exe}$ is defined by the rules in table \ref{tbl:abi-exe}.
\begin{table}[!h]
\begin{tabular}{l l}
\\ \hline \\
\small{\textsc{[Ability-Exe]}} & \\
& \footnotesize{$Char_{Active}, Char_{Next}, Ability \vdash \langle AName, sto \rangle \Rightarrow_{A\_exe} \langle sto[Char_{Active}(Mana) \; -\!\! = cost] \rangle$} \\
\footnotesize{Where} & \footnotesize{$ef\!f = (enemy, ef\!f, cost, ef\!fMana)$}\\
 & \footnotesize{$ef\!fect(sto, Char_{Next}, ef\!fMana) = sto'$}\\
\\ \hline
\end{tabular}
\caption{Transition rules for $\Rightarrow_{A\_exe}$}
\label{tbl:abi-exe}
\end{table}

Behaviour description to come
\todo{describe behaviour}
%Test text..
\begin{comment}
Missing:
Behaviour
Event/forced behaviour
Win-condition

\end{comment}


%\pagebreak
%
\begin{table}[!h]
\begin{tabular}{l l}
\\ \hline \\
\small{\textsc{Physical-Dmg}} & \\
 & \footnotesize{$Physical \langle sto, l \rangle \Rightarrow sto[l \mapsto x - i]$} \\
 \\ \hline
\end{tabular}
\caption{Transition rule for Physical damage}
\label{tbl:physical}
\end{table}
\todo{Not sure if this have to be in}
%%%%%%%%%%%%%
% Vi har nogle regler der skal beskrives med brødtekst.
% Kan ikke lige huske hvilke der mangler lige nu.. Det håber jeg at Danny kan hjælpe med at huske........
%%%%%%%%%%%%%